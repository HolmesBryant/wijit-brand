/**
* @author Holmes Bryant <https://github.com/HolmesBryant>
* @license GPL-3.0
*/
export default class WijitForm extends HTMLElement{#t=!1;#n="dialog-message";#e={};#r=!1;#i=!1;#o=!0;#s=!0;#a="json";#l;#c;#d;errorElems;successElems;waitingElems;default={success:"<h3>Submission Received</h3><p>Thank you!</p>",error:"<h3>Oopsie!</h3><p>There was an error. Your submission was not received.</p>",waiting:"<h1>Please Wait...</h1>"};dialog;testing=!1;static observedAttributes=["custom-css","dialog-message-id","error","fetch-options","force-error","modal","reset","response","success","waiting"];constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n<style id="wijit-form-css">\n@layer wijit-form {\n\n\twijit-form {\n    --accent-color: dodgerblue;\n    --bg1-color: rgb(250,250,250);\n    --bg2-color: rgb(245,245,245);\n    --bg3-color: white;\n    --border-color: silver;\n    --fail-color: hsl(6, 93%, 80%);\n    --pass-color: hsl(112, 70%, 75%);\n    --text-color-: rgb(40,40,40);\n    --text-color-light: rgb(240,240,240);\n    --text-color-dark: rgb(40,40,40);\n    --gap: .5rem;\n    --min: 35px;\n    --min-panel: 270px;\n    --pad: .5rem;\n\n    background-color: var(--bg1-color);\n    border-radius: 10px;\n    color: var(--text-color);\n    display: inline-block;\n    padding: var(--pad);\n    width: 100%;\n    overflow: auto;\n    scrollbar-gutter: stable both-edges;\n\t\tscrollbar-color: var(--bg2-color) var(--bg3-color);\n\t}\n\n\twijit-form > * {\n\t\tbox-sizing: border-box;\n\t}\n\n\t@media (prefers-color-scheme: dark) {\n \t\twijit-form {\n      --bg1-color: rgb(35,35,35);\n      --bg2-color: rgb(40,40,40);\n      --bg3-color: rgb(60,60,60);\n      --border-color: dimgray;\n      --text-color: rgb(240,240,240);\n \t\t}\n  }\n\n  @media only screen and (max-width: 1024px) {\n   \twijit-form {\n   \t\t--pad: .25rem;\n   \t\t--gap: .25rem;\n   \t}\n  }\n\n  @media only screen and (max-width: 380px) {\n   \twijit-form {\n   \t\t--pad: 0;\n   \t\t--gap: 5px;\n   \t}\n  }\n} /* layer */\n\n/*********************/\n/**** Backgrounds ****/\n/*********************/\n\n  wijit-form details > *,\n  wijit-form fieldset,\n  wijit-form section\n  { background-color: var(--bg2-color); }\n\n  wijit-form button,\n  wijit-form input,\n  wijit-form input::before,\n  wijit-form select,\n  wijit-form textarea\n  { background-color: var(--bg3-color); }\n\n  wijit-form hr\n  { background-color: silver; }\n\n  wijit-form .primary,\n  wijit-form option:checked\n  { background-color: var(--accent-color); }\n\n  wijit-form progress\n  { background-color: transparent; }\n\n  wijit-form progress::-webkit-progress-bar\n  { background: transparent; }\n\n  wijit-form progress::-webkit-progress-value\n  { background-color: var(--accent-color); }\n\n\twijit-form progress::-moz-progress-bar\n\t{ background-color: var(--accent-color); }\n\n  wijit-form .error\n  { background-color: var(--fail-color); }\n\n  wijit-form .success\n  { background-color: var(--pass-color); }\n\n  wijit-form input[type=range]::-webkit-slider-thumb\n  { background-color: var(--accent-color); }\n\n  wijit-form input[type=range]::-moz-range-thumb\n  { background-color: var(--accent-color); }\n\n/********************************/\n/****** Borders / Outlines ******/\n/********************************/\n\n  wijit-form button,\n  wijit-form fieldset,\n  wijit-form input,\n  wijit-form input::before,\n  wijit-form progress,\n  wijit-form select,\n  wijit-form textarea,\n  wijit-form .error,\n  wijit-form .success\n  { border: 1px solid var(--border-color); }\n\n  wijit-form option\n  { border-bottom: 1px solid var(--border-color); }\n\n  wijit-form hr,\n  wijit-form option:last-child\n  { border: none; }\n\n  wijit-form input:user-valid:not([type="submit"]):not([type="reset"]):not([type="range"])\n  { border-color: var(--pass-color) }\n\n  wijit-form :user-invalid\n  { border-color: var(--fail-color) }\n\n  wijit-form .success\n  { border-color: var(--pass-color); }\n\n  wijit-form .error\n  { border-color: var(--fail-color); }\n\n\twijit-form button,\n\twijit-form fieldset,\n\twijit-form hr,\n\twijit-form input,\n\twijit-form input::before,\n\twijit-form option,\n\twijit-form progress,\n\twijit-form progress::-webkit-progress-value,\n\twijit-form progress::-webkit-progress-bar,\n\twijit-form section,\n\twijit-form select,\n\twijit-form textarea,\n\twijit-form .error,\n\twijit-form .success\n\t{ border-radius: .5rem; }\n\n\twijit-form input[type=range]::-webkit-slider-thumb\n  { border-radius: 50%; }\n\n  wijit-form input[type=range]::-moz-range-thumb\n  { border-radius: 50%; }\n\n\twijit-form input[type="radio"],\n\twijit-form input[type="radio"]::before\n\t{ border-radius: 50%; }\n\n\twijit-form option\n\t{ border-radius: 0; }\n\n\twijit-form option:first-child\n\t{ border-radius: .5rem .5rem 0 0; }\n\n\twijit-form option:last-child\n\t{ border-radius: 0 0 .5rem .5rem; }\n\n  wijit-form :focus-visible\n  {\n  \tborder-color: transparent;\n  \toutline: 1px solid var(--accent-color);\n  }\n\n  wijit-form input:checked::before\n  { outline: 2px solid var(--accent-color); }\n\n/******************************/\n/*********** Accent ***********/\n/******************************/\n\n  wijit-form input\n  { accent-color: var(--accent-color); }\n\n/******************************/\n/************ Text ************/\n/******************************/\n\n  wijit-form label.required:after\n  { color: var(--fail-color) }\n\n  wijit-form button,\n  wijit-form input,\n  wijit-form fieldset,\n  wijit-form label,\n  wijit-form legend,\n  wijit-form option,\n  wijit-form select,\n  wijit-form textarea\n  { color: var(--text-color); }\n\n  wijit-form .primary,\n  wijit-form option:checked\n  { color: var(--text-color-light); }\n\n  wijit-form input:checked::before {\n    color: var(--accent-color);\n  }\n\n  wijit-form option,\n  wijit-form button,\n  wijit-form input,\n  wijit-form fieldset,\n  wijit-form label,\n  wijit-form legend,\n  wijit-form option,\n  wijit-form select,\n  wijit-form textarea\n  {\n      font-size: 1rem;\n      letter-spacing: .1rem;\n  }\n\n  wijit-form input[type="checkbox"]::before,\n  wijit-form input[type="radio"]::before\n  { font-size: var(--min); }\n\n  wijit-form label.required:after\n  { font-size: small }\n\n  wijit-form select:not([multiple]):not([size]) option {\n\t\tfont-size: larger;\n\t}\n\n  wijit-form button,\n  wijit-form input[type="button"],\n  wijit-form input[type="reset"],\n  wijit-form input[type="submit"],\n  wijit-form label,\n  wijit-form legend,\n  wijit-form option,\n  wijit-form select,\n  wijit-form .error,\n  wijit-form .success\n  { font-weight:bold; }\n\n  wijit-form .error,\n  wijit-form .success\n  { text-align: center; }\n\n  wijit-form .primary,\n  wijit-form option:checked\n  { text-shadow: 1px 1px 1px black; }\n\n/*********************/\n/****** Shadows ******/\n/*********************/\n\n  wijit-form  button:hover,\n  wijit-form input[type="button"]:hover,\n  wijit-form input[type="image"]:hover,\n  wijit-form input[type="submit"]:hover,\n  wijit-form input[type="reset"]:hover,\n  wijit-form option:hover\n  { box-shadow: 2px 2px 5px black; }\n\n  wijit-form button:active,\n  wijit-form input[type="button"]:active,\n  wijit-form input[type="image"]:active,\n  wijit-form input[type="submit"]:active,\n  wijit-form input[type="reset"]:active,\n  wijit-form option:active,\n  wijit-form option:checked\n  { box-shadow: inset 2px 2px 5px black; }\n\n  wijit-form input[type=range]::-webkit-slider-thumb:hover {\n    box-shadow: 2px 2px 5px black;\n  }\n\n  wijit-form input[type=range]::-moz-range-thumb:hover {\n    box-shadow: 2px 2px 5px black;\n  }\n\n  wijit-form input[type=range]:active::-webkit-slider-thumb {\n    box-shadow: inset 2px 2px 5px black;\n  }\n\n  wijit-form input[type=range]:active::-moz-range-thumb {\n    box-shadow: inset 2px 2px 5px black;\n  }\n\n  wijit-form input[type=range]:focus::-webkit-slider-thumb {\n    box-shadow: inset 2px 2px 5px black;\n  }\n\n  wijit-form input[type=range]:focus::-moz-range-thumb {\n    box-shadow: inset 2px 2px 5px black;\n  }\n\n/*********************/\n/******* Cursor ******/\n/*********************/\n\n  wijit-form input[type="button"],\n  wijit-form input[type="checkbox"],\n  wijit-form input[type="radio"],\n  wijit-form input[type="color"],\n  wijit-form input[type="range"],\n  wijit-form input[type="reset"],\n  wijit-form input[type="submit"],\n  wijit-form label,\n  wijit-form button,\n  wijit-form select\n  { cursor: pointer; }\n\n  wijit-form input:disabled,\n  wijit-form *[disabled]\n  { cursor: not-allowed; }\n\n/*********************/\n/***** Structure *****/\n/*********************/\n\n  wijit-form button,\n  wijit-form input[type=submit],\n  wijit-form input[type=reset] {\n  \tmargin: var(--gap);\n  }\n\n  wijit-form button,\n\twijit-form input {\n  \tmin-height: var(--min);\n  \tmax-height: var(--min);\n  \tmin-width: var(--min);\n  \tpadding: var(--pad);\n\t}\n\n\twijit-form div {\n\t\talign-items: stretch;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-wrap: wrap;\n\t\tgap: 0 var(--gap);\n\t\tjustify-content: center;\n\t\tmargin: 1rem 0;\n\t}\n\n\twijit-form div.row\n\t{ align-items: center; }\n\n\twijit-form div > *,\n\twijit-form fieldset > *,\n\twijit-form section > *\n\t{ flex: 1; }\n\n\twijit-form fieldset {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-wrap: wrap;\n\t\tgap: var(--gap);\n\t\toverflow-x: hidden;\n\t\toverflow-y: auto;\n\t\tpadding: var(--pad);\n\t}\n\n\twijit-form header {\n\t\tdisplay: block;\n\t\tflex-grow: 0;\n\t\tflex-shrink: 0;\n\t}\n\n\twijit-form hr {\n\t\tmin-width: 100%;\n\t\tmax-height: 5px;\n\t}\n\n\twijit-form .row > hr {\n\t\tmin-width: 5px;\n\t\tmargin: 0;\n\t\tmax-width: 5px;\n\t\tmax-height: 100%;\n\t}\n\n  wijit-form input:disabled {\n    opacity: 0.7;\n  }\n\n\twijit-form input[type="checkbox"],\n\twijit-form input[type="radio"] {\n\t\tappearance: none;\n    height: var(--min);\n    position: relative;\n    width: var(--min);\n  }\n\n  wijit-form input:checked::before {\n    content: "";\n    line-height: 0;\n    position: absolute;\n    display: flex;\n    height: 100%;\n    width: 100%;\n    align-items: center;\n    justify-content: center;\n  }\n\n  wijit-form input[type="checkbox"]:checked::before {\n  \tcontent: "✔";\n  }\n\n  wijit-form input[type="radio"]:checked::before {\n    content: "⬤";\n  }\n\n  wijit-form input[type="color"],\n  wijit-form input[type="checkbox"],\n  wijit-form input[type="radio"] {\n  \tflex: 0;\n  \tflex-basis: var(--min);\n  \tpadding: 0;\n  \twidth: var(--min);\n  }\n\n  wijit-form input[type=file]::file-selector-button {\n  \tbackground-color: var(--bg2-color);\n\t\tborder: 1px solid var(--border-color);\n\t\tborder-radius: .5rem;\n\t\tcolor: var(--text-color);\n\t\tfont-weight: bold;\n\t\tpadding: var(--pad);\n  }\n\n  /***** Input Range *****/\n\n  wijit-form div:has(input[type=range]) > label::after {\n  \tcontent: attr(data-value);\n  \tmargin: 0 var(--gap);\n  \tfont-weight: normal;\n  }\n\n  wijit-form input[type=range] {\n  \tappearance: none;\n  \t-webkit-appearance: none;\n    width: 100%;\n    cursor: pointer;\n    outline: none;\n    padding: 0;\n    max-height: var(--pad);\n    min-height: var(--pad);\n  }\n\n  wijit-form input[type=range]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    height: var(--min);\n    width: var(--min);\n  }\n\n  wijit-form input[type=range]::-moz-range-thumb {\n  \tappearance: none;\n    height: var(--min);\n    width: var(--min);\n  }\n\n  /***** /Range *****/\n\n  wijit-form div:has(input[type=range]) > label {\n  \tmargin-bottom: var(--gap);\n  }\n\n\twijit-form label {\n\t\tflex: 0;\n\t\twhite-space: nowrap;\n\t}\n\n\twijit-form option {\n\t\tpadding: 1rem;\n\t\tmin-height: var(--min);\n\t}\n\n\twijit-form progress {\n\t\t-webkit-appearance: none;\n\t\t-moz-appearance: none;\n\t\tappearance: none;\n\t\tinline-size: 100%;\n\t\tmin-height: 1rem;\n\t}\n\n\twijit-form div:has(progress) label::after {\n\t\tcontent: attr(data-value);\n\t\tfont-weight: normal;\n\t\tmargin: 0 var(--gap);\n\t}\n\n\twijit-form progress::-webkit-progress-value\n\t{ min-height: 1rem; }\n\n\twijit-form section {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-wrap: wrap;\n\t\tgap: var(--gap);\n\t\toverflow: auto;\n\t\tpadding: var(--pad);\n\t}\n\n\twijit-form section + section\n\t{ margin: 1rem 0; }\n\n\twijit-form section.row section + section\n\t{ margin: 0; }\n\n\twijit-form select {\n  \tmin-height: var(--min);\n  \tmin-width: var(--min);\n  \toverflow-y: auto;\n\t}\n\n  wijit-form textarea\n  {\n  \tmin-height: 5rem;\n  \tmin-width: 10rem;\n  \tpadding: var(--pad);\n  \twidth: 100%;\n  }\n\n  wijit-form .required:after {\n  \tcontent: "*";\n  \tfont-size: x-large;\n  \tvertical-align: super;\n  }\n\n /**** Classes ****/\n\n\twijit-form .center > *,\n\twijit-form .start > *,\n\twijit-form .end > *,\n\twijit-form .space-around > *,\n\twijit-form .space-between > *\n\t{ flex: 0 1 max-content; }\n\n\twijit-form .center {\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\twijit-form section.row.center {\n\t\talign-items: normal;\n\t}\n\n\twijit-form .end {\n\t\talign-content: flex-end;\n\t\tjustify-content: flex-end;\n\t}\n\n\twijit-form .reverse.end {\n\t\talign-content: flex-start;\n\t\tjustify-content: flex-start;\n\t}\n\n\twijit-form .nowrap\n\t{ flex-wrap: nowrap}\n\n\twijit-form .reverse\n\t{ flex-direction: column-reverse; }\n\n\twijit-form .row\n\t{ flex-direction: row; }\n\n\twijit-form .row.reverse\n\t{ flex-direction: row-reverse; }\n\n\twijit-form .space-around {\n\t\tjustify-content: space-around;\n\t\talign-content: space-around;\n\t}\n\n\twijit-form .space-between {\n\t\tjustify-content: space-between;\n\t}\n\n\twijit-form .row.space-between {\n\t\talign-content: space-between;\n\t}\n\n\twijit-form .reverse.start {\n\t\talign-content: flex-end;\n\t\tjustify-content: flex-end;\n\t}\n\n\twijit-form .flex0 {\n\t\tflex: 0;\n\t}\n\n\twijit-form .flex1 {\n\t\tflex: 1;\n\t}\n\n\twijit-form .flex2 {\n\t\tflex: 2;\n\t}\n</style>\n\n<style>\n:host {\n\t--fail-color: darksalmon;\n\t--pass-color: limegreen;\n}\n\nbutton {\n\tbackground-color: var(--accent-color);\n\tborder: 1px solid var(--border-color);\n\tborder-radius: 5px;\n\tcolor: var(--text-color);\n\tcursor: pointer;\n\tfont-size: large;\n\tfont-weight: bold;\n\toutline-color: var(--accent-color);\n\tpadding: var(--pad);\n}\n\nbutton:hover,\nbutton:focus {\n\tbox-shadow: 2px 2px 5px black;\n}\n\nbutton:active {\n\tbox-shadow: inset 2px 2px 5px black;\n}\n\ndialog {\n\tbackground: transparent;\n\tborder: none;\n\tbox-sizing: border-box;\n\tcolor: var(--text-color);\n\toutline: none;\n\ttext-align: center;\n}\n\ndialog::backdrop {\n\tbackground-color: white;\n\tcolor: black;\n\topacity: 0.75;\n}\n\ndialog.modeless {\n\taccent-color: transparent;\n\tbackdrop-filter: blur(.3rem);\n\theight: 100%;\n\toutline: none;\n\toverflow: hidden;\n\tpadding: 0;\n\ttop: 0;\n\twidth: 100%;\n}\n\ndialog.modeless[open] {\n\tdisplay: table;\n}\n\n.hidden\n{ display: none; }\n\n#dialog-message {\n\tbackground-color: var(--bg3-color);\n\tborder: 1px solid var(--border-color);\n\tborder-radius: 10px;\n\tdisplay: table-cell;\n\tpadding: 1rem;\n\tvertical-align: middle;\n}\n\ndialog.modeless #dialog-message {\n\ttransition: all 1s;\n}\n\n#dialog-message.waiting {\n\tbackground-color: transparent;\n\tborder: none;\n\tmargin: auto;\n\tpadding: 0;\n\twidth: auto;\n}\n\n#dialog-message.error {\n\tborder-color: var(--fail-color);\n}\n\n#dialog-message.success {\n\tborder-color: var(--pass-color);\n}\n\n#wrapper {\n\tposition: relative;\n\n}\n\n@media (prefers-color-scheme: dark) {\n\tdialog::backdrop {\n\t\tbackground-color: black;\n\t\tcolor: white;\n\t}\n}\n</style>\n\n<div id="wrapper">\n<slot></slot>\n<slot name="dialog">\n\t<dialog class="modeless">\n\t\t<div id="dialog-message">\n\t\t\t<slot name="message"></slot>\n\t\t</div>\n\t\t<form method="dialog" class="hidden">\n\t\t\t<button>OK</button>\n\t\t</form>\n\t</dialog>\n</slot>\n</div>\n\n<div hidden id="responses" style="display:none">\n<button aria-label="close" form="dialog-form">OK</button>\n<slot name="waiting"></slot>\n<slot name="success"></slot>\n<slot name="error"></slot>\n</div>\n',this.mainAbortController=new AbortController}connectedCallback(){this.errorElems=this.querySelectorAll("[slot=error]"),this.successElems=this.querySelectorAll("[slot=success]"),this.waitingElems=this.querySelectorAll("[slot=waiting]"),this.customCss||this.addDefaultCss(),this.handleRangeInputs(this.querySelectorAll("input[type=range]")),this.handleProgressElems(this.querySelectorAll("progress")),this.addEventListeners()}attributeChangedCallback(t,n,e){e=e.toLowerCase(),t.indexOf("-")>-1&&(t=(t=t.split("-").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join("")).replace(t.charAt(0),t.charAt(0).toLowerCase())),this[t]=e}disconnectedCallback(){this.mainAbortController.abort()}addEventListeners(){const t=this.querySelector("form"),n=this.querySelector("dialog")||this.shadowRoot.querySelector("dialog");this.addFocusListeners(this.querySelectorAll("input")),t&&t.addEventListener("submit",(t=>{t.preventDefault(),this.reset&&t.target.reset(),this.submitData(t)}),{signal:this.mainAbortController.signal}),n.addEventListener("close",((t,n)=>{this.reset&&this.resetElements(n)}),{signal:this.mainAbortController.signal})}async submitData(t){if(t.preventDefault(),t.target.action.endsWith("false"))return;let n,e;const r=new FormData(t.target),i="html"===this.response?"text/html":"application/json",o=t.target.getAttribute("method")||"POST",s=this.setFetchOptions(o,i);if(this.testing||this.showDialog(this.waiting,null),t.target.action.endsWith("test")?this.#s=!1:(this.#s=!0,n=t.target.action),"GET"===s.method||"HEAD"===s.method){let t=0;n+="?";for(const e of r.entries())n+=0===t?e.join("="):`&${e.join("=")}`,t++;n=encodeURI(n)}else s.body=r;if(this.#s)return e=await this.fetchData(n,s),this.testing?this.setMessage(e.data,e.status):this.showDialog(e.data,e.status);this.result=this.simulateServer(s),setTimeout((()=>this.showDialog(this.result.data,this.result.status)),1e3)}async fetchData(t,n){try{const e=await fetch(t,n),r=e.status,i=e.headers.get("Content-Type");return{data:i.includes("json")?await e.json():await e.text(),status:r}}catch(t){return{data:"<h1>Server Error</h1>",status:status}}}simulateServer(t){let n,e;const r=t.body,i="<p>This result is a simulation. No server side form processing was performed.";return t.data=Object.fromEntries(r.entries()),delete t.body,this.forceError?(e=500,"html"===this.response?(n="<h1>Error</h1><p>HTML response</p>",n+=i):n=t):(e=200,"html"===this.response?(n="<h1>Success</h1><p>HTML response</p>",n+=i):n=t),{data:n,status:e}}setFetchOptions(t,n="POST"){const e=this.fetchOptions?JSON.parse(JSON.stringify(this.fetchOptions)):{};return e.method=n.toUpperCase(),e.headers=e.headers||{},e.headers.Accept=e.headers.Accept||t,e}showDialog(t,n){const e=this.querySelector("dialog")||this.shadowRoot.querySelector("dialog"),r=e.querySelector(`#${this.dialogMessageId}`),i=this.setMessage(t,n),o=e.querySelector("form[method=dialog]"),s=o.querySelector("input[type=submit], button");return i&&(r.innerHTML=i),r.append(o),n?(o.classList.remove("hidden"),s.focus()):o.classList.add("hidden"),this.modal?(e.classList.remove("modeless"),e.showModal()):(e.classList.add("modeless"),e.show()),e}setMessage(t,n){const{waitingElems:e,errorElems:r,successElems:i}=this,o=(this.querySelector("dialog")||this.shadowRoot.querySelector("dialog")).querySelector(`#${this.dialogMessageId}`);let s,a,l;return this.clearMessage(),null===n?(s="waiting",a=e,o.classList.add("waiting")):n>399?(s="error",a=r,o.classList.add("error"),o.classList.remove("waiting")):(s="success",a=i,o.classList.add("success"),o.classList.remove("waiting")),null!==this[s]&&void 0!==this[s]?l="json"===this.response?this.replacePlaceholders(this[s],t):this[s]:a.length>0?("json"===this.response&&this.replaceNodeContents(a,t),a.forEach((t=>t.setAttribute("slot","message")))):l="html"===this.response?null===n?this.default[s]:t:this.default[s],l}replacePlaceholders(t,n){const e=/{{([^{}]+)}}/g;let r,i=t;for(;null!==(r=e.exec(i));){const t=r[1].split(".");let e=n;for(const n of t)if(e=e?.[n],void 0===e)break;i=i.replace(r[0],void 0===e?r[0]:JSON.stringify(e))}return i.replaceAll('"',"")}replaceNodeContents(t,n){const e=/{{([^{}]+)}}/g;for(const r of t){let t,i=r.innerHTML;for(;null!==(t=e.exec(i));){const e=t[1].split(".");let r=n;for(const t of e)if(r=r?.[t],void 0===r)break;i=i.replace(t[0],void 0===r?t[0]:r)}r.innerHTML=i}return t}addFocusListeners(t){for(const n of t)"textarea"!==n.localName&&n.addEventListener("focus",(()=>{"function"==typeof n.select&&n.select()}),{signal:this.mainAbortController.signal})}resetElements(t){if(!t)return;const n=t.querySelectorAll("input, select, textarea");t.reset(),n[0].focus()}clearMessage(){const t=(this.querySelector("dialog")||this.shadowRoot.querySelector("dialog")).querySelector(`#${this.dialogMessageId}`);t.classList.remove("error"),t.classList.remove("success");for(const t of this.waitingElems)t.setAttribute("slot","waiting");for(const t of this.errorElems)t.setAttribute("slot","error");for(const t of this.successElems)t.setAttribute("slot","success")}cleanHTML(t){const n=new Set(["p","span","h1","h2","h3","h4","h5","h6","b","strong","i","hr","br"]),e=new Set(["id","class","style"]),r=document.createElement("div");r.innerHTML=t;for(let t=r.childNodes.length-1;t>=0;t--){const i=r.childNodes[t];if(i.nodeType===Node.ELEMENT_NODE){if(!n.has(i.localName.toLowerCase())){r.replaceChild(document.createTextNode(i.textContent),i);continue}const t=Array.from(i.attributes).filter((t=>e.has(t.name)));for(const t of i.attributes)i.removeAttribute(t);for(const n of t)i.setAttribute(n.name,n.value)}}return r.innerHTML}validateJson(t){try{return JSON.parse(t)}catch(n){try{const n=t.replace(/['"<>;\s\t\n\r?()]/g,"").replace(/([\w:\/\\]+)/g,'"$&"');return JSON.parse(n)}catch(t){return!1}}}handleRangeInputs(t){if(0!==t.length)for(const n of t){const t=n.value/n.max*100,e=n.parentElement.querySelector("label"),r=n.getAttribute("data-value");if(r){const t=r.replace(/[\d]+/,n.value);e.setAttribute("data-value",t)}n.style.background=`linear-gradient(to right, var(--accent-color) ${t}%, transparent ${t}%)`,n.addEventListener("input",(t=>{const i=t.target.value/n.max*100;if(r){const t=r.replace(/[\d]+/,n.value);e.setAttribute("data-value",t)}n.style.background=`linear-gradient(to right, var(--accent-color) ${i}%, transparent ${i}%)`}))}}handleProgressElems(t){if(0===t.length)return;const n=function(t){const n=t.parentElement.querySelector("label"),e=t.getAttribute("data-value");if(e){const r=e.replace(/[\d]+/,t.value);n.setAttribute("data-value",r)}},e=new MutationObserver((t=>{t.forEach((t=>{if("value"===t.attributeName){t.target.value;n(t.target)}}))})),r={attributes:!0,attributeFilter:["value"]};for(const i of t)n(i),e.observe(i,r)}addDefaultCss(){document.head.querySelector("#wijit-form-css")||document.head.append(this.defaultCss())}defaultCss(){return this.shadowRoot.querySelector("#wijit-form-css")}get customCss(){return this.#t}set customCss(t){switch(t){case"false":case!1:t=!1;const n=document.head.querySelector("style#wijit-form-css");n&&n.remove();break;default:t=!0,this.addDefaultCss()}this.#t=t}get dialogMessageId(){return this.#n}set dialogMessageId(t){this.#n=t}get fetchOptions(){return this.#e}set fetchOptions(t){"string"==typeof t&&(t=this.validateJson(t)),this.#e=null===t?{}:t}get forceError(){return this.#r}set forceError(t){let n=this.querySelector("input[name=fail]");const e=this.querySelector("form");switch(t){case"false":case!1:this.#r=!1,n&&n.remove();break;default:this.#r=!0,n||(n=document.createElement("input"),n.name="fail",n.value="true",n.type="hidden",e?e.append(n):this.append(n))}}get modal(){return this.#i}set modal(t){switch(t){case"false":case!1:t=!1;break;default:t=!0}this.#i=t}get reset(){return this.#o}set reset(t){switch(t){case"false":case!1:t=!1;break;default:t=!0}this.#o=t}get response(){return this.#a}set response(t){this.#a=t.toLowerCase()}get error(){return this.#l}set error(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#l=t}get success(){return this.#c}set success(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#c=t}get waiting(){return this.#d}set waiting(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#d=t}}document.addEventListener("DOMContentLoaded",customElements.define("wijit-form",WijitForm));
